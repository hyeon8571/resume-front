<!DOCTYPE html>
<lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
          rel="stylesheet"
          integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
          crossorigin="anonymous">

    <title>이력서 게시판</title>
    <style>
        h1 {
            margin-top: 60px;
            margin-left: 180px;
        }

        h2 {
            margin-top: 25px;
            margin-left: 180px;
            color: 
            gray;
        }

        .profileDiv {
            margin-top: 1px;
            max-width: 1280px;
        }

        .table {
            margin-top: 60px;
            table-layout: fixed;
            border-collapse: collapse;
        }


        .table tr {
            border-bottom: 1px dotted lightgray;
        }

        .table td {
            color: gray;
        }

        .educationTable {
            margin-top: 120px;
            width: 100%;
            table-layout: fixed;
            border: 1px solid #444;
            border-collapse: collapse;
        }

        .educationTable th, .educationTable td {
            border: 1px solid #444444;
            text-align: center;
        }
    
        .majorTable {
            margin-top: 70px;
            width: 100%;
            table-layout: fixed;
            border: 1px solid #444;
            border-collapse: collapse;
        }

        .majorTable th, .majorTable td {
            border: 1px solid #444444;
            text-align: center;
        }

        .certificateTable {
            margin-top: 70px;
            width: 100%;
            table-layout: fixed;
            border: 1px solid #444;
            border-collapse: collapse;
        }

        .certificateTable th, .certificateTable td {
            border: 1px solid #444444;
            text-align: center;
        }

        .relatedActivityTable {
            margin-top: 70px;
            width: 100%;
            table-layout: fixed;
            border: 1px solid #444;
            border-collapse: collapse;
        }

        .relatedActivityTable th, .relatedActivityTable td {
            border: 1px solid #444444;
            text-align: center;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        footer {
            margin-top: 20px;
        }

        .btnDiv {
            float: right;
            margin-top: 70px;
            margin-bottom: 3px;
            position: relative;
        }

        .profileBtn {
            margin-top: 5px;
            margin-bottom: 3px;
            position: relative;
            float: right;
        }

        .cursorDelete {
            cursor : pointer;
        }

        .field-error {
            border-color: #dc3545;
            color: #dc3545;
        }

    </style>
</head>
<body>
    <div class="profileDiv row">
        <div class="col-8">
            <h1 id="proName">name</h1>
            <h2 id="proJob">job</h2>
        </div>
        <div class="col-4">
        <table class="table">
            <tr>
                <td class="col1">BirthDay</td>
                <td colspan="2" id="proBirth">1999.06.19</td>
            </tr>
            <tr>
                <td class="col1">Email</td>
                <td colspan="2" id="proEmail">w010@gmail.com</td>
            </tr>
            <tr>
                <td class="col1">Mobile</td>
                <td colspan="2" id="proMobile"></td>
            </tr>
            <tr>
                <td class="col1">Address</td>
                <td colspan="2" id="proAddress"></td>
            </tr>
        </table>
        <div class="profileBtn">
            <button type="button" class="btn btn-secondary btn-sm" onclick="addProfileForm()">개인정보 입력</button>
        </div>
    </div>

    <div class="container" style="width: 50%; margin-bottom: 10px; display: none;" id="addProfileForm">
        <form action method="post">
        <span class="card" style="margin-bottom: 1rem">
            <ul class="list-group list-group-flush">
                <li class="list-group-item" id="addProName">
                    <input placeholder="이름" type="text" class="form-control" style="height: 50px;">
                    
                    <div class="field-error" style="display: none">에러 메시지</div>
                </li>

                <li class="list-group-item" id="addProJob">
                    <input placeholder="희망 직무" type="text" class="form-control" style="height: 50px;">

                    <div class="field-error" style="display: none;">에러 메시지</div>
                </li>

                <li class="list-group-item" id="addProBirth">
                    <div class="row">
                        <div style="width:200px;" class="col">
                            <input placeholder="YYYY"  id="addProYear" type="text" class="form-control" style="height: 50px;" maxlength="3">
                        </div>
                        <div style="width:200px;" class="col">
                            <input placeholder="MM" type="text"  id="addProMonth" class="form-control" style="height: 50px;" maxlength="4">
                        </div>
                        <div style="width:200px;" class="col">
                            <input placeholder="DD" type="text"  id="addProDay" class="form-control" style="height: 50px;" maxlength="4">
                        </div>
                    </div>
                    <div class="field-error" style="display: none">에러 메시지</div>
                </li>
    
                <li class="list-group-item" id="addProEmail">
                    <input placeholder="이메일" type="text" class="form-control" style="height: 50px;">
                    
                    <div class="field-error" style="display: none">에러 메시지</div>
                </li>
    
                <li class="list-group-item" id="addProTel">
                    <div class="row">
                        <div style="width:200px;" class="col">
                            <input placeholder="연락처"  id="addProTelFront" type="text" class="form-control" style="height: 50px;" maxlength="3">
                        </div>
                        <div style="width:200px;" class="col">
                            <input type="text"  id="addProTelMiddle" class="form-control" style="height: 50px;" maxlength="4">
                        </div>
                        <div style="width:200px;" class="col">
                            <input type="text"  id="addProTelEnd" class="form-control" style="height: 50px;" maxlength="4">
                        </div>
                    </div>
                    <div class="field-error" style="display: none">에러 메시지</div>
                </li>
    
                <li class="list-group-item" id="addProAddress">
                    <input placeholder="주소" type="text" class="form-control" style="height: 50px;">
                    
                    <div class="field-error" style="display: none">에러 메시지</div>
                </li>
            </ul>
        </span>
    
            <div style="display:inline; float: right;">
                <div class="row">
                    <div class="col-sm-8">
                        <button class="btn btn-secondary btn-lg" type="button" id="addProfile"
                                style="font-size:16px; width: 100px; height: 50px;">
                            저장
                        </button>
                    </div>
                    <div class="col-sm-1"></div>
                </div>
            </div>
        </form>
    </div>
    
    </div>

    <div class="container">
        <div class="btnDiv">
            <button type="button" class="btn btn-secondary btn-sm" onclick="addEducationForm()">+</button>
        </div>
        <div class="educationDiv">
            <table class="educationTable">
                <thead>
                    <tr>
                        <th style="width: 10%; background-color: lightgray;">No</th>
                        <th style="width: 30%; background-color: lightgray;">학교명</th>
                        <th style="background-color: lightgray;">기간</th>
                        <th style="width: 15%; background-color: lightgray;">상태</th>
                    </tr>
                </thead>
                <tbody id="education-row" class="cursorDelete">
                    
                </tbody>
            </table>
        </div>
    </div>

    <div class="container" style="width: 50%; margin-bottom: 30px; margin-top: 50px; display: none;" id="addEducationForm">
        <form action method="post">
        <span class="card" style="margin-bottom: 1rem">
            <ul class="list-group list-group-flush">
            
                <li class="list-group-item" id="addEduName">
                    <input placeholder="학교" type="text" class="form-control" style="height: 50px;">
                    
                    <div class="field-error" style="display: none">에러 메시지</div>
                </li>
    
                <li class="list-group-item" id="addEduStart">
                    <div class="row">
                        <label>시작</label>
                        <div style="width:200px;" class="col">
                            <input placeholder="YYYY" id="addEduStartYear" type="text" class="form-control" style="height: 50px;" maxlength="4">
                        </div>
                        <div style="width:200px;" class="col">
                            <input placeholder="MM" id="addEduStartMonth" type="text" class="form-control" style="height: 50px;" maxlength="2">
                        </div>
                        <div style="width:200px;" class="col">
                            <input placeholder="DD" id="addEduStartDay" type="text" class="form-control" style="height: 50px;" maxlength="2">
                        </div>
                    </div>
                    <div class="field-error" style="display: none">에러 메시지</div>    
                </li>
    
                <li class="list-group-item" id="addEduEnd">
                    <div class="row">
                        <label>종료</label>
                        <div style="width:200px;" class="col">
                            <input placeholder="년" id="addEduEndYear" type="text" class="form-control" style="height: 50px;" maxlength="4">
                        </div>
                        <div style="width:200px;" class="col">
                            <input placeholder="월" id="addEduEndMonth" type="text" class="form-control" style="height: 50px;" maxlength="2">
                        </div>
                        <div style="width:200px;" class="col">
                            <input placeholder="일" id="addEduEndDay" type="text" class="form-control" style="height: 50px;" maxlength="2">
                        </div>
                    </div>
                    <div class="field-error" style="display: none">에러 메시지</div>    
                </li>
    
                <li class="list-group-item" id="addEduStatus">
                    <input placeholder="상태" type="text" class="form-control" style="height: 50px;">
                    
                    <div class="field-error" style="display: none">에러 메시지</div>
                </li>
            </ul>
        </span>
    
            <div style="display:inline; float: right;">
                <div class="row">
                    <div class="col-sm-8">
                        <button class="btn btn-secondary btn-lg" type="button" id="addEducation"
                                style="font-size:16px; width: 100px; height: 50px;">
                            저장
                        </button>
                    </div>
                    <div class="col-sm-1"></div>
                </div>
            </div>
        </form>
    </div>

    <div class="container">
        <div class="btnDiv">
            <button type="button" class="btn btn-secondary btn-sm" onclick="addMajorForm()">+</button>
        </div>
        <div class="majorDiv">
            <table class="majorTable">
                <thead>
                    <tr>
                        <th style="width: 10%; background-color: lightgray;">No</th>
                        <th style="width: 50%; background-color: lightgray;">전공</th>
                        <th style="background-color: lightgray;">학점</th>
                        <th style="width: 15%; background-color: lightgray;">구분</th>
                    </tr>
                </thead>
                <tbody id="major-row" class="cursorDelete">
                    
                </tbody>
            </table>
        </div>
    </div>
    <div class="container" style="width: 50%; margin-bottom: 30px; margin-top: 50px; display: none;" id="addMajorForm">
        <form action method="post">
        <span class="card" style="margin-bottom: 1rem">
            <ul class="list-group list-group-flush">
                <li class="list-group-item" id="addMajorName">
                     <input placeholder="전공" type="text" class="form-control" style="height: 50px;">
        
                     <div class="field-error" style="display: none">에러 메시지</div>
                </li>
                <li class="list-group-item" id="addMajorGrade">
                    <input placeholder="학점" type="text" class="form-control" style="height: 50px;">
       
                    <div class="field-error" style="display: none">에러 메시지</div>
               </li>
               <li class="list-group-item" id="addMajorDegree">
                <input placeholder="학사/석사/박사" type="text" class="form-control" style="height: 50px;">
   
                <div class="field-error" style="display: none">에러 메시지</div>
           </li>
                </ul>
            </span>
            <div style="display:inline; float: right;">
                <div class="row">
                    <div class="col-sm-8">
                        <button class="btn btn-secondary btn-lg" type="button" id="addMajor"
                                style="font-size:16px; width: 100px; height: 50px;">
                            저장
                        </button>
                    </div>
                    <div class="col-sm-1"></div>
                </div>
            </div>
        </form>
    </div>

    <div class="container">
        <div class="btnDiv">
            <button type="button" class="btn btn-secondary btn-sm" onclick="addCertificateForm()">+</button>
        </div>
        <div class="certificateDiv">
            <table class="certificateTable">
                <thead>
                    <tr>
                        <th style="width: 10%; background-color: lightgray;">No</th>
                        <th style="width: 25%; background-color: lightgray;">자격증</th>
                        <th style="background-color: lightgray;">발급일</th>
                        <th style="width: 25%; background-color: lightgray;">발급기관</th>
                    </tr>
                </thead>
                <tbody id="certificate-row" class="cursorDelete">
                    
                </tbody>
            </table>
        </div>
    </div>

    <div class="container" style="width: 50%; margin-bottom: 10px; margin-top: 50px; display: none;" id="addCerForm">
        <form action method="post">
            <span class="card" style="margin-bottom: 1rem">
                <ul class="list-group list-group-flush">

                    <li class="list-group-item" id="addCerName">
                        <input placeholder="자격증명" type="text" class="form-control" style="height: 50px;">

                        <div class="field-error" style="display: none">에러 메시지</div>
                    </li>

                    <li class="list-group-item" id="addCerAcq">
                        <div class="row">
                            <label>발급일</label>
                            <div style="width:200px;" class="col">
                                <input placeholder="YYYY" id="addCerYear" type="text" class="form-control"
                                    style="height: 50px;" maxlength="4">
                            </div>
                            <div style="width:200px;" class="col">
                                <input placeholder="MM" id="addCerMonth" type="text" class="form-control"
                                    style="height: 50px;" maxlength="2">
                            </div>
                            <div style="width:200px;" class="col">
                                <input placeholder="DD" id="addCerDay" type="text" class="form-control"
                                    style="height: 50px;" maxlength="2">
                            </div>
                        </div>
                        <div class="field-error" style="display: none">에러 메시지</div>
                    </li>

                    <li class="list-group-item" id="addCerAuthority">
                        <input placeholder="발급기관" type="text" class="form-control" style="height: 50px;">

                        <div class="field-error" style="display: none">에러 메시지</div>
                    </li>
                </ul>
            </span>

            <div style="display:inline; float: right;">
                <div class="row">
                    <div class="col-sm-8">
                        <button class="btn btn-secondary btn-lg" type="button" id="addCertificate"
                            style="font-size:16px; width: 100px; height: 50px;">
                            정보 입력
                        </button>
                    </div>
                    <div class="col-sm-1"></div>
                </div>
            </div>
        </form>
    </div>

    <div class="container">
        <div class="btnDiv">
            <button type="button" class="btn btn-secondary btn-sm" onclick="addRelatedActivityForm()">+</button>
        </div>
        <div class="relatedActivityDiv">
            <table class="relatedActivityTable">
                <thead>
                    <tr>
                        <th style="width: 10%; background-color: lightgray;">No</th>
                        <th style="width: 55%; background-color: lightgray;">활동내용</th>
                        <th style="background-color: lightgray;">기간</th>
                    </tr>
                </thead>
                <tbody id="relatedActivity-row" class="cursorDelete">
                    
                </tbody>
            </table>
        </div>
    </div>

    <div class="container" style="width: 50%; margin-bottom: 10px; margin-top: 50px; display: none;" id="addRelForm">
        <form action method="post">
            <span class="card" style="margin-bottom: 1rem">
                <ul class="list-group list-group-flush">

                    <li class="list-group-item" id="addRelContent">
                        <input placeholder="활동내용" type="text" class="form-control" style="height: 50px;">

                        <div class="field-error" style="display: none">에러 메시지</div>
                    </li>

                    <li class="list-group-item" id="addRelStart">
                        <div class="row">
                            <label>시작</label>
                            <div style="width:200px;" class="col">
                                <input placeholder="YYYY" id="addRelStartYear" type="text" class="form-control" style="height: 50px;" maxlength="4">
                            </div>
                            <div style="width:200px;" class="col">
                                <input placeholder="MM" id="addRelStartMonth" type="text" class="form-control" style="height: 50px;" maxlength="2">
                            </div>
                            <div style="width:200px;" class="col">
                                <input placeholder="DD" id="addRelStartDay" type="text" class="form-control" style="height: 50px;" maxlength="2">
                            </div>
                        </div>
                        <div class="field-error" style="display: none">에러 메시지</div>    
                    </li>
        
                    <li class="list-group-item" id="addRelEnd">
                        <div class="row">
                            <label>종료</label>
                            <div style="width:200px;" class="col">
                                <input placeholder="YYYY" id="addRelEndYear" type="text" class="form-control" style="height: 50px;" maxlength="4">
                            </div>
                            <div style="width:200px;" class="col">
                                <input placeholder="MM" id="addRelEndMonth" type="text" class="form-control" style="height: 50px;" maxlength="2">
                            </div>
                            <div style="width:200px;" class="col">
                                <input placeholder="DD" id="addRelEndDay" type="text" class="form-control" style="height: 50px;" maxlength="2">
                            </div>
                        </div>
                        <div class="field-error" style="display: none">에러 메시지</div>    
                    </li>
        
                </ul>
            </span>

            <div style="display:inline; float: right;">
                <div class="row">
                    <div class="col-sm-8">
                        <button class="btn btn-secondary btn-lg" type="button" id="addRelatedActivity"
                            style="font-size:16px; width: 100px; height: 50px;">
                            정보 입력
                        </button>
                    </div>
                    <div class="col-sm-1"></div>
                </div>
            </div>
        </form>
    </div>

    <footer style="margin-top: 30px;">
        <hr>
        <div class="row">
            <div class="col-md-12 text-center">
                <p>&copy; Seunghyeon's Resume</p>
            </div>
        </div>
    </div>
    </footer>
</body>
</html>

<script>

    window.onload = function() {
        const url = "http://localhost:8080/";
        fetch(url, {
            method: "GET",
            headers: {
                "Content-Type" : "application/json"
            }
        }).then(response => {
            return response.json();
        }).then(resume => {
            makeResume(resume);
            makeAddProfileForm(resume);
        })
    }
   
    function makeResume(resume) {
        makeProfile(resume.profile);
        makeCertificate(resume.certificates);
        makeEducation(resume.educations);
        makeMajor(resume.majors);
        makeRelatedActivity(resume.relatedActivities);
    }

    function makeProfile(profile) {
        document.getElementById("proName").innerText = profile.name;
        document.getElementById("proJob").innerText = profile.job;
        document.getElementById("proBirth").innerText = profile.birth;
        document.getElementById("proMobile").innerText = profile.phone_number;
        document.getElementById("proEmail").innerText = profile.email;
        document.getElementById("proAddress").innerText = profile.address;
    }

    function makeCertificate(certificates) {
        certificates.forEach((certificate, index) => {
            const row = document.createElement('tr');
            row.innerHTML = `
            <td style="display: none;">${certificate.id}</td>
            <td>${index+1}</td>
            <td>${certificate.name}</td>
            <td>${certificate.acquisition_date}</td>
            <td>${certificate.authority}</td>
            `
            document.querySelector(".certificateTable tbody").appendChild(row);
        })
    }

    function makeEducation(educations) {
        educations.forEach((education, index) => {
            const row = document.createElement('tr');
            row.innerHTML = `
            <td style="display: none;">${education.id}</td>
            <td>${index+1}</td>
            <td>${education.name}</td>
            <td>${education.period}</td>
            <td>${education.status}</td>
            `
            document.querySelector(".educationTable tbody").appendChild(row);
        })
    }
 
    function makeMajor(majors) {
        majors.forEach((major, index) => {
            const row = document.createElement('tr');
            row.innerHTML = `
            <td style="display: none;">${major.id}</td>
            <td>${index+1}</td>
            <td>${major.name}</td>
            <td>${major.grade}</td>
            <td>${major.degree}</td>
            `
            document.querySelector(".majorTable tbody").appendChild(row);
        })
    }


    function makeRelatedActivity(relatedActivities) {
        relatedActivities.forEach((relatedActivity, index) => {
            const row = document.createElement('tr');
            row.innerHTML = `
            <td style="display: none;">${relatedActivity.id}</td>
            <td>${index+1}</td>
            <td>${relatedActivity.content}</td>
            <td>${relatedActivity.period}</td>
            `
            document.querySelector(".relatedActivityTable tbody").appendChild(row);
        })
    }

    let addProName = document.querySelector("#addProName");
    let addProJob = document.querySelector("#addProJob");
    let addProYear = document.querySelector("#addProYear");
    let addProMonth = document.querySelector("#addProMonth");
    let addProDay = document.querySelector("#addProDay");
    let addProTelFront = document.querySelector("#addProTelFront");
    let addProTelMiddle = document.querySelector("#addProTelMiddle");
    let addProTelEnd = document.querySelector("#addProTelEnd");
    let addProEmail = document.querySelector("#addProEmail");
    let addProAddress = document.querySelector("#addProAddress")

    function makeAddProfileForm(resume) {

        addProName.querySelector("input").value = resume.profile.name;
        addProJob.querySelector("input").value = resume.profile.job;
        addProYear.value = resume.profile.birth.split(".")[0];
        addProMonth.value = resume.profile.birth.split(".")[1];
        addProDay.value = resume.profile.birth.split(".")[2];
        addProTelFront.value = resume.profile.phone_number.split("-")[0];
        addProTelMiddle.value = resume.profile.phone_number.split("-")[1];
        addProTelEnd.value = resume.profile.phone_number.split("-")[2];
        addProEmail.querySelector("input").value = resume.profile.email;
        addProAddress.querySelector("input").value = resume.profile.address;
    }


    let profileCnt = 0;

    function addProfileForm() {
        const addProfileForm = document.querySelector("#addProfileForm");

        profileCnt++;

        if (profileCnt % 2 === 0) {
            addProfileForm.style.display = "none";
        } else {
            addProfileForm.style.display = "block";
        }
    }

    function combineBirth(year, month, day) {
        return year + "." + month + "." + day;
    }

    function combinePhone(front, middle, end) {
        return front + "-" + middle + "-" + end;
    }

    const addProfile = document.querySelector("#addProfile");

    addProfile.addEventListener('click', function() {

        initErrorField();

        const profile = {
            name: addProName.querySelector("input").value,
            job: addProJob.querySelector("input").value,
            birth: combineBirth(addProYear.value, addProMonth.value, addProDay.value),
            phone_number: combinePhone(addProTelFront.value, addProTelMiddle.value, addProTelMiddle.value),
            email: addProEmail.querySelector("input").value,
            address: addProAddress.querySelector("input").value
        }

        const result = confirm("개인정보를 업데이트 하시겠습니까?")

        const url = "http://localhost:8080/api/profile"

        console.log(profile);

        if (result) {
            fetch(url, {
            method: "POST",
            body: JSON.stringify(profile),
            headers: {
                "Content-Type": "application/json"
            }
        }).then(response => {
            return checkResponse(response);
        }).then(errors => {
            errors.forEach((error)=>{
            const itemId = profileErrorMapper(error.field)
            const item = document.querySelector(itemId);
            const errorDiv = item.querySelector(".field-error");
            
            const message = parseErrorMessage(error.message);

            errorDiv.style.display="block";
            template = `<div>${message}</div>`;
            errorDiv.innerHTML = template;
        })
        })
        }
    })

    let educationCnt = 0;

    function addEducationForm() {

        const addEducationForm = document.querySelector("#addEducationForm");

        educationCnt++;

        if (educationCnt % 2 === 0) {
            addEducationForm.style.display = "none";
        } else {
            addEducationForm.style.display = "block";
        }
    }

    function combineDay(sYear, sMonth, sDay, eYear, eMonth, eDay) {
        return sYear + "." + sMonth + "." + sDay + " ~ " + eYear + "." + eMonth + "." + eDay;
    }

    let addEduName = document.querySelector("#addEduName");
    let addEduStartYear = document.querySelector("#addEduStartYear");
    let addEduStartMonth = document.querySelector("#addEduStartMonth");
    let addEduStartDay = document.querySelector("#addEduStartDay");
    let addEduEndYear = document.querySelector("#addEduEndYear");
    let addEduEndMonth = document.querySelector("#addEduEndMonth");
    let addEduEndDay = document.querySelector("#addEduEndDay");
    let addEduStatus = document.querySelector("#addEduStatus");

    const addEducation = document.querySelector("#addEducation");

    addEducation.addEventListener('click', function() {

        initErrorField();

        const education = {
            name: addEduName.querySelector("input").value,
            period: combineDay(addEduStartYear.value, addEduStartMonth.value, addEduStartDay.value, addEduEndYear.value, addEduEndMonth.value, addEduEndDay.value),
            status: addEduStatus.querySelector("input").value
        }

        console.log(education)
        const url = "http://localhost:8080/api/education"

        const result = confirm("학력 정보를 업데이트 하시겠습니까?")
        if (result) {
            fetch(url, {
                method: "POST",
                body: JSON.stringify(education),
                headers: {
                    "Content-Type": "application/json"
                }
            }).then(response => {
            return checkResponse(response);
        }).then(errors => {
            errors.forEach((error)=>{
            const itemId = educationErrorMapper(error.field)
            console.log("item ", itemId);
            const item = document.querySelector(itemId);
            const errorDiv = item.querySelector(".field-error");
            
            const message = parseErrorMessage(error.message);

            errorDiv.style.display="block";
            template = `<div>${message}</div>`;
            errorDiv.innerHTML = template;
        })
        })
        }

    })

    let majorCnt = 0;

    function addMajorForm() {
        const addMajorForm = document.querySelector("#addMajorForm");

        majorCnt++;

        if (majorCnt % 2 === 0) {
            addMajorForm.style.display = "none";
        } else {
            addMajorForm.style.display = "block";
        }
    }

    let addMajorName = document.querySelector("#addMajorName");
    let addMajorGrade = document.querySelector("#addMajorGrade");
    let addMajorDegree = document.querySelector("#addMajorDegree");

    const addMajor = document.querySelector("#addMajor");

    addMajor.addEventListener('click', function() {

        initErrorField();
        const major = {
            name: addMajorName.querySelector("input").value,
            grade: addMajorGrade.querySelector("input").value,
            degree: addMajorDegree.querySelector("input").value
        }

        const url = "http://localhost:8080/api/major"

        const result = confirm("전공 정보를 업데이트 하시겠습니까?")
        if (result) {
            fetch(url, {
            method: "POST",
            body: JSON.stringify(major),
            headers: {
                "Content-Type": "application/json"
            }
        }).then(response => {
            return checkResponse(response);
        }).then(errors => {
            errors.forEach((error)=>{
            const itemId = majorErrorMapper(error.field)
            const item = document.querySelector(itemId);
            const errorDiv = item.querySelector(".field-error");
            
            const message = parseErrorMessage(error.message);

            errorDiv.style.display="block";
            template = `<div>${message}</div>`;
            errorDiv.innerHTML = template;
        })
        })
        }
    })
    
    let certificateCnt = 0;

    function addCertificateForm() {

        const addCerForm = document.querySelector("#addCerForm");

        certificateCnt++;

        if (certificateCnt % 2 === 0) {
            addCerForm.style.display = "none";
        } else {
            addCerForm.style.display = "block";
        }
    }

    let addCerName = document.querySelector("#addCerName");
    let addCerYear = document.querySelector("#addCerYear");
    let addCerMonth = document.querySelector("#addCerMonth");
    let addCerDay = document.querySelector("#addCerDay");
    let addCerAuthority = document.querySelector("#addCerAuthority");

    const addCertificate = document.querySelector("#addCertificate");

    addCertificate.addEventListener('click', function() {

        initErrorField();

        const certificate = {
            name: addCerName.querySelector("input").value,
            acquisition_date: combineBirth(addCerYear.value, addCerMonth.value, addCerDay.value),
            authority: addCerAuthority.querySelector("input").value
        }

        console.log(certificate)

        const url = "http://localhost:8080/api/certificate"

        const result = confirm("자격증 정보를 업데이트 하시겠습니까?")
        if (result) {
            fetch(url, {
                method: "POST",
                body: JSON.stringify(certificate),
                headers: {
                    "Content-Type": "application/json"
                }
            }).then(response => {
            return checkResponse(response);
        }).then(errors => {
            errors.forEach((error)=>{
            const itemId = certificateErrorMapper(error.field)
            const item = document.querySelector(itemId);
            const errorDiv = item.querySelector(".field-error");
            
            const message = parseErrorMessage(error.message);

            errorDiv.style.display="block";
            template = `<div>${message}</div>`;
            errorDiv.innerHTML = template;
        })
        })
        }
    })

    let relatedActivityCnt = 0;

    function addRelatedActivityForm() {
        const addRelForm = document.querySelector("#addRelForm");

        relatedActivityCnt++;

        if (relatedActivityCnt % 2 === 0) {
            addRelForm.style.display = "none";
        } else {
            addRelForm.style.display = "block";
        }
    }

    let addRelContent = document.querySelector("#addRelContent");
    let addRelStartYear = document.querySelector("#addRelStartYear");
    let addRelStartMonth = document.querySelector("#addRelStartMonth");
    let addRelStartDay = document.querySelector("#addRelStartDay");
    let addRelEndYear = document.querySelector("#addRelEndYear");
    let addRelEndMonth = document.querySelector("#addRelEndMonth");
    let addRelEndDay =  document.querySelector("#addRelEndDay");

    const addRelatedActivity = document.querySelector("#addRelatedActivity");

    addRelatedActivity.addEventListener('click', function() {

        initErrorField();

        const relatedActivity = {
            content: addRelContent.querySelector("input").value,
            period: combineDay(addRelStartYear.value, addRelStartMonth.value, addRelStartDay.value, addRelEndYear.value, addRelEndMonth.value, addRelEndDay.value)
        }

        const url = "http://localhost:8080/api/related-activity"

        const result = confirm("관련활동 정보를 업데이트 하시겠습니까?")
        if (result) {
            fetch(url, {
                method: "POST",
                body: JSON.stringify(relatedActivity),
                headers: {
                    "Content-Type": "application/json"
                }
            }).then(response => {
            return checkResponse(response);
        }).then(errors => {
            errors.forEach((error)=>{
            const itemId = relatedActivityErrorMapper(error.field)
            const item = document.querySelector(itemId);
            const errorDiv = item.querySelector(".field-error");
            
            const message = parseErrorMessage(error.message);

            errorDiv.style.display="block";
            template = `<div>${message}</div>`;
            errorDiv.innerHTML = template;
        })
        })
        }
    })


    const educationRow = document.querySelector("#education-row");
    educationRow.addEventListener('click', function(e){
        deleteRow("education", e);
    })

    const certificateRow = document.querySelector("#certificate-row");
    certificateRow.addEventListener('click', function(e){
        deleteRow("certificate", e);
    })

    const majorRow = document.querySelector("#major-row");
    majorRow.addEventListener('click', function(e){
        deleteRow("major", e);
    })

    const relatedActivityRow = document.querySelector("#relatedActivity-row");
    relatedActivityRow.addEventListener('click', function(e) {
        deleteRow("related-actvity", e);
    })

    function deleteRow(table, row){
        const clickedTable = row.target;
        const clickedRow = clickedTable.parentNode;
        console.log(clickedRow);
        const id = clickedRow.cells[0].textContent;
        
        if(confirm(id + "번을 삭제하시겠습니까?")){
            const url = `http://localhost:8080/api/${table}?id=` + id;
            console.log(url);
            fetch(url, {
                method: "DELETE"
            }).then(response => {
                if(response.ok){
                    clickedRow.remove();
                    alert("삭제되었습니다");
                }
            })
        }
    }


    function initErrorField(){
        const errorFields = document.querySelectorAll(".field-error");
        errorFields.forEach(e => {
            e.style.display = "none";
        });
    }

    function checkResponse(response) {

        if(response.ok) {
            alert("정보가 저장되었습니다.");
            window.location.reload();
        } else {
            return response.json();
        }
    }


    function profileErrorMapper(key) {
        switch(key) {
            case "name" :
                return "#addProName";
                

            case "job" :
                return "#addProJob";
                

            case "birth" : 
                return "#addProBirth";
                

            case "phone_number" : 
                return "#addProTel";
                

            case "email": 
                return "#addProEmail";
                

            case "address": 
                return "#addProAddress";
                
        }
    }

    function educationErrorMapper(key) {
        switch(key) {
            case "name": 
                return "#addEduName";
                

            case "period":
                return "#addEduEnd";
                

            case "status": 
                return "#addEduStatus";
                
        }
    }

    function majorErrorMapper(key) {
        switch(key) {
            case "name": 
                return "#addMajorName";
                
            
            case "grade":
                return "#addMajorGrade";
                

            case "degree":
                return "#addMajorDegree";
                
        }
    }

    function certificateErrorMapper(key) {
        switch(key) {
            case "name":
                return "#addCerName";

            
            case "acquisition_date":
                return "#addCerAcq";
                

            case "authority": 
                return "#addCerAuthority";
        }
    }

    function relatedActivityErrorMapper(key) {
        switch(key) {
            case "content": 
                return "#addRelContent"

            case "period": 
                return "#addRelEnd";
        }
    }

    function parseErrorMessage(message){

        const messages = message.split(",").sort();
        let result = ""

        for(i=0;i<messages.length-1;i++){
            result += messages[i] + "<br>";
        }

        result += messages[messages.length-1];
        return result;
}

</script>